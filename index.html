<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mighty Activity & Food</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0f172a;
  color:#e5e7eb;
  font-family:system-ui,sans-serif;
  margin:0;padding:20px
}
h1{text-align:center}
.grid{
  display:grid;
  grid-template-columns:120px 1fr 1fr 1fr;
  gap:2px;
  margin-top:20px
}
.cell{
  border:1px solid #334155;
  padding:8px;
  background:#1f2937
}
.time{background:#334155;font-weight:700;text-align:center}
textarea{
  width:100%;
  min-height:70px;
  background:transparent;
  color:#f8fafc;
  border:none;
  resize:vertical
}
.section{background:#475569;font-weight:700;text-align:center}
.food{grid-column:span 3}
</style>
</head>

<body>
<h1 id="date"></h1>

<h2>Activities</h2>
<div class="grid" id="activityGrid"></div>

<h2>Foods</h2>
<div class="grid" id="foodGrid"></div>

<script type="module">
/* ---------- FIREBASE ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const app = initializeApp({
  apiKey: "AIzaSyCGckwVoIWxLnIWPFS6z2hfKBB_pM7SW9k",
  authDomain: "todo-d025d.firebaseapp.com",
  databaseURL: "https://todo-d025d-default-rtdb.firebaseio.com",
  projectId: "todo-d025d",
  storageBucket: "todo-d025d.appspot.com",
  messagingSenderId: "1031984794235",
  appId: "1:1031984794235:web:3dba6a11ac44dbd4c770de"
});

const db = getDatabase(app);

/* ---------- CONFIG ---------- */
const timeSlots = [
 '4-5 AM','5-6 AM','6-7 AM','7-8 AM','8-9 AM','9-10 AM',
 '10-11 AM','11-12 PM','12-1 PM','1-2 PM','2-3 PM','3-4 PM',
 '4-5 PM','5-6 PM','6-7 PM','7-8 PM','8-9 PM','9-10 PM','10-11 PM'
];
const sections = ['Working','Holiday','Sunday'];

const today = new Date().toISOString().split('T')[0];
document.getElementById('date').textContent = today;

let activities = {};
let foods = {};

/* ---------- LOAD DATA ---------- */
async function loadData(){
  const actSnap = await get(ref(db,'activities'));
  const foodSnap = await get(ref(db,'foods'));

  activities = {};
  foods = {};

  if (actSnap.exists()) {
    Object.entries(actSnap.val()).forEach(([k,v])=>{
      if (k.startsWith(today+'_')) {
        const clean = k.replace(today+'_','');
        activities[clean] = v;
      }
    });
  }

  if (foodSnap.exists()) {
    Object.entries(foodSnap.val()).forEach(([k,v])=>{
      if (k.startsWith(today+'_')) {
        foods[k.replace(today+'_','')] = v;
      }
    });
  }

  drawActivities();
  drawFoods();
}

/* ---------- DRAW ---------- */
function drawActivities(){
  const g = document.getElementById('activityGrid');
  g.innerHTML='';

  g.append(cell('Time','time'));
  sections.forEach(s=>g.append(cell(s,'section')));

  timeSlots.forEach(time=>{
    g.append(cell(time,'time'));
    sections.forEach((_,i)=>{
      const key = `${i}_${time}`;
      const ta = document.createElement('textarea');
      if (activities[key]) ta.value = activities[key];
      ta.onblur = ()=>saveActivity(i,time,ta.value);
      g.append(wrap(ta));
    });
  });
}

function drawFoods(){
  const g = document.getElementById('foodGrid');
  g.innerHTML='';

  g.append(cell('Time','time'));
  g.append(cell('Foods ðŸ±','section food'));

  timeSlots.forEach(time=>{
    g.append(cell(time,'time'));
    const ta=document.createElement('textarea');
    if (foods[time]) ta.value = foods[time];
    ta.onblur = ()=>saveFood(time,ta.value);
    g.append(wrap(ta,'food'));
  });
}

/* ---------- SAVE ---------- */
function saveActivity(sec,time,val){
  const key = `${today}_${sec}_${time}`;
  if (val.trim()) {
    set(ref(db,'activities/'+key),val.trim());
  }
}

function saveFood(time,val){
  const key = `${today}_${time}`;
  if (val.trim()) {
    set(ref(db,'foods/'+key),val.trim());
  }
}

/* ---------- HELPERS ---------- */
function cell(txt,cls){
  const d=document.createElement('div');
  d.className='cell '+(cls||'');
  d.textContent=txt;
  return d;
}
function wrap(el,cls){
  const d=document.createElement('div');
  d.className='cell '+(cls||'');
  d.append(el);
  return d;
}

/* ---------- INIT ---------- */
loadData();
</script>
</body>
</html>
